<p>I wrote a node module called <a href="http://tybenz.com/paper-router">paper-router</a>.
It’s sole purpose is to help me organize my node apps.</p>

<h2 id="it-turns-this">it turns this</h2>

<p>```javascript
var restify = require(‘restify’);
var BananaModel = require( ‘./models/banana.js’ );
var PeelModel = require( ‘./models/peel.js’ );</p>

<p>var server = restify.createServer({
    name: ‘luca’,
});</p>

<p>server.use( function crossOrigin( req, res, next ) {
    res.header( “Access-Control-Allow-Origin”, “*” );
    res.header( “Access-Control-Allow-Headers”, “X-Requested-With” );
    return next();
});</p>

<p>server.use( restify.acceptParser( server.acceptable ) );
server.use( restify.queryParser() );
server.use( restify.bodyParser() );
server.pre( restify.pre.sanitizePath() );</p>

<p>server.get( ‘/’, function( req, res, next ) {
    res.send( { message: ‘You are home’ } );
})</p>

<p>server.get( ‘/bananas’, function( req, res, next ) {
    res.send( BananaModel.getAll() );
});</p>

<p>server.post( ‘/bananas’, function( req, res, next ) {
    var banana = BananaModel.new({
        weight: req.params.weight,
        length: req.params.length,
    })
    .save();</p>

<pre><code>res.send( banana ); });
</code></pre>

<p>server.get( ‘/bananas/:banana_id/peels’, function( req, res, next ) {
    var peels = PeelModel.where( { banana_id: req.params.banana_id } );</p>

<pre><code>res.send( peels ); });
</code></pre>

<p>server.listen( 8000, function() {
    console.log( “%s listening at %s”, server.name, server.url );
});
```</p>

<h2 id="into-this">into this</h2>

<p>```javascript
var restify = require(‘restify’);
var PaperRouter = require( ‘paper-router’ );
var routes = require( ‘./routes’ );</p>

<p>var server = restify.createServer({
    name: ‘luca’,
});</p>

<p>server.use( function crossOrigin( req, res, next ) {
    res.header( “Access-Control-Allow-Origin”, “*” );
    res.header( “Access-Control-Allow-Headers”, “X-Requested-With” );
    return next();
});</p>

<p>server.use( restify.acceptParser( server.acceptable ) );
server.use( restify.queryParser() );
server.use( restify.bodyParser() );
server.pre( restify.pre.sanitizePath() );</p>

<p>//
// Using paper router to separate out controllers from routes
// Routes are read in from a separate file (see routes.js below)
//
var router = new PaperRouter( server, __dirname + ‘/controllers’, routes );</p>

<p>server.listen( 8000, function() {
    console.log( “%s listening at %s”, server.name, server.url );
});
```</p>

<p>routes.js:</p>

<p>```javascript
module.exports = function( router ) {
    // GET ‘/’ =&gt; controller: ‘home’, action: ‘index’
    router.get( ‘/’, ‘home#index’ );</p>

<pre><code>// Creates the following routes but only if the actions exist
// GET '/bananas' =&gt; controller: 'bananas', action: 'index'
// GET '/bananas/:id' =&gt; controller: 'bananas', action: 'show'
// GET '/bananas/new' =&gt; controller: 'bananas', action: 'new'
// GET '/bananas/:id/edit' =&gt; controller: 'bananas', action: 'edit'
// POST '/bananas' =&gt; controller: 'bananas', action: 'create'
// PUT '/bananas/:id' =&gt; controller: 'bananas', action: 'update'
// DELETE '/bananas/:id' =&gt; controller: 'bananas', action: 'destroy'
router.resources( 'bananas' );

// Creates the following routes but only if the actions exist
// GET '/bananas/:banana_id/peels' =&gt; controller: 'peels', action: 'index'
// GET '/bananas/:banana_id/peels/:id' =&gt; controller: 'peels', action: 'show'
// GET '/bananas/:banana_id/peels/new' =&gt; controller: 'peels', action: 'new'
// GET '/bananas/:banana_id/peels/:id/edit' =&gt; controller: 'peels', action: 'edit'
// POST '/bananas/:banana_id/peels' =&gt; controller: 'peels', action: 'create'
// PUT '/bananas/:banana_id/peels/:id' =&gt; controller: 'peels', action: 'update'
// DELETE '/bananas/:banana_id/peels/:id' =&gt; controller: 'peels', action: 'destroy'
router.resources( 'peels', '/bananas/:banana_id' ); }; ```
</code></pre>

<p>bananasController.js:</p>

<p>```javascript
// bananasController.js
var BananaModel = require( ‘../models/banana.js’ );</p>

<p>// Controllers are just plain objects with actions as properties
// Use typical CRUD action names to line up with paper-router’s
// resourceful routing (see routes.js)
var BananaController = {
    index: function( req, res, next ) {
        res.send( BananaModel.getAll() );
    }</p>

<pre><code>create: function( req, res, next ) {
    var banana = BananaModel.new({
        weight: req.params.weight,
        length: req.params.length,
    })
    .save();

    res.send( banana );
} };
</code></pre>

<p>module.exports = BananaController;
```</p>

<p>peelsController.js</p>

<p>```javascript
// peelsController.js
var PeelModel = require( ‘../models/peel.js’ );</p>

<p>var PeelsController = {
    index: function( req, res, next ) {
        var peels = PeelModel.where( { banana_id: req.params.banana_id } );</p>

<pre><code>    res.send( peels );
} };
</code></pre>

<p>module.exports = PeelsController;
```</p>

<p>homeController.js</p>

<p>```javascript
// homeController.js
var HomeController = {
    index: function( req, res, next ) {
        res.send( { message: ‘You are home’ } );
    }
};</p>

<p>module.exports = HomeController;
```</p>
